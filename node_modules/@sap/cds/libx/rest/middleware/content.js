const PPP = { POST: 1, PUT: 1, PATCH: 1 }
const UPDATE = { PUT: 1, PATCH: 1 }

module.exports = (req, res, next) => {
  if (PPP[req.method]) {
    const contentType = req.headers['content-type'] && req.headers['content-type'].split(';')
    if (
      contentType &&
      (!contentType[0].match(/^application\/json$/) || (typeof contentType[1] === 'string' && !contentType[1]))
    ) {
      throw { statusCode: 415, code: '415', message: 'INVALID_CONTENT_TYPE_ONLY_JSON' }
    }
    if (UPDATE[req.method] && Array.isArray(req.body)) {
      throw { statusCode: 400, code: '400', message: `INVALID_${req.method}` }
    }
  }

  next()
}
